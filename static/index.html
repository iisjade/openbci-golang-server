<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript">
			if (window["WebSocket"]) {
				conn = new WebSocket("ws://{{$}}/ws");
				conn.onclose = function(evt) {
					console.log("closing");
				}
				conn.onmessage = function(evt) {
					data = JSON.parse(evt.data);
					console.log("received data:", data);
					var newDatum = data.FFTs.FFTChan1.slice(0, 125);
					bciVis.updateData(newDatum);
				}
				conn.onopen = function(evt) {
					console.log("opening");
				}
			} else {
				appendLog($("<div><b>Your browser does not support WebSockets.</b></div>"));
			}
			$(window).on('beforeunload', function() {
				console.log("Closing websocket");
				conn.close();
			});
		</script>
	</head>

	<body>
		<script src="/js/handler.js"></script>
		
		<canvas id="canvas" width="400" height="300">
		
		</canvas>
		
		<script id="vertShader" type="x-shader/x-vertex">
			uniform mat4 modelMat;
			uniform mat4 viewMat;
			uniform mat4 projMat;
			
			attribute vec3 pos;
			
			varying vec4 worldPos;
			void main() {
				worldPos = modelMat * vec4(pos, 1);
				gl_Position = projMat * viewMat * worldPos;
			}
			
		</script>
		
		<script id="fragShader" type="x-shader/x-fragment">
			
			varying mediump vec4 worldPos;
			
			void main() {
				gl_FragColor = vec4(1.0 - worldPos.y, worldPos.y, 0.0, 1.0);
				gl_FragColor.xy = normalize(gl_FragColor.xy);
				
			}
		</script>
		
		<script src="http://localhost:8888/js/webgl-debug.js"></script>
		
		<script src="/js/gl-matrix-min.js"></script>
		<script src="/js/geometry.js"></script>
		<script src="/js/main.js"></script>

		<div id="streamcommands" align="center">
			<input type="button" value="open" href="http://{{$}}/open">
			<input type="button" value="reset" href="http://{{$}}/reset">
			<input type="button" value="start" href="http://{{$}}/start">
			<input type="button" value="stop" href="http://{{$}}/stop">
			<input type="button" value="close" href="http://{{$}}/close">
			<input type="button" value="gentest" href="http://{{$}}/test">
			<input type="button" value="save" href="http://{{$}}/save">
		</div>

		<div id="chantoggle" align="left"><br>
			<input type="checkbox" value="1" href="http://{{$}}/x/" checked>Channel 1<br> 
			<input type="checkbox" value="2" href="http://{{$}}/x/" checked>Channel 2<br>
			<input type="checkbox" value="3" href="http://{{$}}/x/" checked>Channel 3<br>
			<input type="checkbox" value="4" href="http://{{$}}/x/" checked>Channel 4<br>
			<input type="checkbox" value="5" href="http://{{$}}/x/" checked>Channel 5<br>
			<input type="checkbox" value="6" href="http://{{$}}/x/" checked>Channel 6<br>
			<input type="checkbox" value="7" href="http://{{$}}/x/" checked>Channel 7<br>
			<input type="checkbox" value="8" href="http://{{$}}/x/" checked>Channel 8<br>
		<br>
		</div>

		<div id="complexcommands" align="left">
			<form id="longcommand">
				<input type="button" id="update" value="update" href="http://{{$}}/x/">

				<select id="channel">
					<option value="0">All Channels</option>
					<option value="1">Channel 1</option>
					<option value="2">Channel 2</option>
					<option value="3">Channel 3</option>
					<option value="4">Channel 4</option>
					<option value="5">Channel 5</option>
					<option value="6">Channel 6</option>
					<option value="7">Channel 7</option>
					<option value="8">Channel 8</option>
				</select>

				<select id="power">
					<option value="0">Power On</option>
					<option value="1">Power Off</option>
				</select>

				<select id="gain">
					<option value="6">24x gain</option>
					<option value="5">12x gain</option>
					<option value="4">8x gain</option>
					<option value="3">6x gain</option>
					<option value="2">4x gain</option>
					<option value="1">2x gain</option>
					<option value="0">1x gain</option>
				</select>

				<select id="input">
					<option value="0">Normal</option>
					<option value="1">Shorted</option>
					<option value="2">Bias meas</option>
					<option value="3">MVDD</option>
					<option value="4">Temp</option>
					<option value="5">Test signal</option>
					<option value="6">Bias DRP</option>
					<option value="7">Bias DRN</option>
				</select>

				<select id="bias">
					<option value="1">Include in BIAS</option>
					<option value="0">Exclude from BIAS</option>
				</select>

				<select id="srb2">
					<option value="1">Connect SRB2</option>
					<option value="0">Disconn SRB2</option>
				</select>

				<select id="srb1">
					<option value="0">Disconn SRB1</option>
					<option value="1">Connect SRB1</option>
				</select>
			</form>
		</div>
	</body>
</html>
